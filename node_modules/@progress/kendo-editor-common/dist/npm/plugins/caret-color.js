"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.caretColor = exports.caretColorKey = void 0;
var prosemirror_state_1 = require("prosemirror-state");
var prosemirror_view_1 = require("prosemirror-view");
var mark_1 = require("./../mark");
exports.caretColorKey = new prosemirror_state_1.PluginKey('caret-color');
function caretColor() {
    return new prosemirror_state_1.Plugin({
        key: exports.caretColorKey,
        props: {
            decorations: function (state) {
                var doc = state.doc, selection = state.selection, storedMarks = state.storedMarks;
                if (!selection.empty || !storedMarks) {
                    return prosemirror_view_1.DecorationSet.empty;
                }
                var color = mark_1.styleValue((storedMarks || []).find(function (m) { return m.type.name === 'style'; }), { name: 'color', value: /^.+$/ });
                if (!color) {
                    return prosemirror_view_1.DecorationSet.empty;
                }
                var parentNode = selection.$anchor.parent;
                var decorations = [];
                doc.descendants(function (node, pos) {
                    if (node.eq(parentNode)) {
                        decorations.push(prosemirror_view_1.Decoration.node(pos, pos + node.nodeSize, {
                            style: 'caret-color: ' + color
                        }));
                    }
                });
                return prosemirror_view_1.DecorationSet.create(doc, decorations);
            }
        }
    });
}
exports.caretColor = caretColor;
